const chatData = {
  "email": ".carla@gmail.com",
  "people_id": "ca0d0153-c2a1-43fa-a960-84fcf9c4f6a0",
  "phone": "+556111545340",
  "nickname": "Carla da Silva +556111545340",
  "notepad": [
    "whatsapp"
  ],
  "conversation": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
  "chat": [
    {
      "session_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
      "type": "text",
      "from": {
        "user_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
        "nickname": "+556111545340"
      },
      "origin": "urn:crisp.im:whatsapp:0",
      "content": "Olá, vi o site do IBCMED e gostaria de mais informações. Pode me ajudar?",
      "user": {
        "user_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
        "nickname": "+556111545340"
      },
      "delivered": "email",
      "timestamp": "2023-02-15T00:12:25.314Z"
    },
    {
      "session_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
      "type": "text",
      "from": {
        "type": "website",
        "nickname": "iBC",
        "avatar": "https://storage.crisp.chat/users/avatar/website/73791cb1178bc400/favicon_1jaf09q.png"
      },
      "origin": "urn:crisp.im:bot:0",
      "content": "Seja Bem-vindo! Como podemos lhe ajudar?\n\nDigite 1 para - Portal do Aluno\nDigite 2 para - Financeiro\nDigite 3 para - Secretaria\nDigite 4 para - Relacionamento\nDigite 5 para - Tutoria\nDigite 6 para - Informações sobre os cursos ofertados pelo IBCMED\nDigite 7 para - Agendamento de Consulta\nDigite 8 para - Outros Assuntos",
      "user": {
        "nickname": "iBC"
      },
      "delivered": "urn:crisp.im:whatsapp:0",
      "timestamp": "2023-02-15T00:12:26.753Z"
    },
    {
      "session_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
      "type": "text",
      "from": {
        "user_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
        "nickname": "+556111545340"
      },
      "origin": "urn:crisp.im:whatsapp:0",
      "content": "7",
      "user": {
        "user_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
        "nickname": "+556111545340"
      },
      "delivered": "email",
      "timestamp": "2023-02-15T00:15:59.276Z"
    },
    {
      "session_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
      "type": "text",
      "from": {
        "type": "website",
        "nickname": "iBC",
        "avatar": "https://storage.crisp.chat/users/avatar/website/73791cb1178bc400/favicon_1jaf09q.png"
      },
      "origin": "urn:crisp.im:bot:0",
      "content": "Olá! Seja Bem-vindo(a) ao IBCMED, tudo bem?\nPara agendamento de consulta, queira informar os seguintes dados:\n\nNome completo:\nE-mail:\nCPF:\nData de nascimento:\nEspecialidade pretendida:\nEspecialidade:",
      "user": {
        "nickname": "iBC"
      },
      "delivered": "urn:crisp.im:whatsapp:0",
      "timestamp": "2023-02-15T00:16:01.688Z"
    },
    {
      "session_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
      "type": "text",
      "from": {
        "user_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
        "nickname": "+556111545340"
      },
      "origin": "urn:crisp.im:whatsapp:0",
      "content": "Carla da Silva \nE-mail .carla@gmail.com\nCpf 704.111.121-95 \nData nascimento. 20/11/1996\nConsulta com .cardiologista",
      "user": {
        "user_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
        "nickname": "+556111545340"
      },
      "delivered": "email",
      "timestamp": "2023-02-15T00:17:39.499Z"
    },
    {
      "session_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
      "type": "text",
      "from": {
        "type": "website",
        "nickname": "iBC",
        "avatar": "https://storage.crisp.chat/users/avatar/website/73791cb1178bc400/favicon_1jaf09q.png"
      },
      "origin": "urn:crisp.im:bot:0",
      "content": "Aguarde um momento, logo um atendente entrará em contato!",
      "user": {
        "nickname": "iBC"
      },
      "delivered": "email",
      "timestamp": "2023-02-15T00:17:41.876Z"
    },
    {
      "session_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
      "type": "note",
      "from": {
        "user_id": "8da425dd-7dfc-422a-8c6b-707a2bda82f6",
        "nickname": "Mari Rodrigues"
      },
      "origin": "chat",
      "content": "@julia",
      "user": {
        "user_id": "8da425dd-7dfc-422a-8c6b-707a2bda82f6",
        "nickname": "Mari Rodrigues"
      },
      "delivered": "",
      "timestamp": "2023-02-15T10:36:34.192Z"
    },
    {
      "session_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
      "type": "text",
      "from": {
        "user_id": "ea90ce1f-ca7b-4ab8-8353-4476d20f8b19",
        "nickname": "Julia Souza de Menezes"
      },
      "origin": "chat",
      "content": "Bom dia, Sra Carla, como está?\n\nNós somos uma instituição educacional que promove ações com a comunidade em atendimentos/consultas específicos e esporádicas de acordo com nossas aulas de especialização bimestrais.\n\nNo momento, nossa ação de consulta supervisionada não está ocorrendo. Quando este ocorrer será divulgado por meio das redes sociais,\n\nSeu nome e dados serão registrados e quando ocorrer o atendimento na especialidade que desejada (cardiologia), faremos o contato.\n\nFicamos à disposição.\nJulia Menezes",
      "user": {
        "user_id": "ea90ce1f-ca7b-4ab8-8353-4476d20f8b19",
        "nickname": "Julia Souza de Menezes"
      },
      "delivered": "email",
      "timestamp": "2023-02-15T13:59:01.929Z"
    },
    {
      "session_id": "session_13cc3a9a-647e-4813-845d-2bd8ae5fefe9",
      "type": "event",
      "from": {
        "user_id": "ea90ce1f-ca7b-4ab8-8353-4476d20f8b19",
        "nickname": "Julia Souza de Menezes"
      },
      "origin": "chat",
      "content": {
        "namespace": "state:resolved"
      },
      "user": {
        "user_id": "ea90ce1f-ca7b-4ab8-8353-4476d20f8b19",
        "nickname": "Julia Souza de Menezes"
      },
      "delivered": "",
      "timestamp": "2023-02-15T13:59:27.817Z"
    }
  ]
}

function formatWhatsAppChat(data) {
    let formattedChat = '';

    data.chat.forEach(message => {
        let timestamp = new Date(message.timestamp);
        let formattedTimestamp = timestamp.toLocaleString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });

        let nameToShow = message.from.nickname;
        if (message.from.nickname === data.phone) {
            nameToShow = data.nickname; // Usando o nickname da raiz do JSON
        }

        let alignment = 'right';
        let containerAlignment = 'flex-end';
        if (message.type === 'note') {
            alignment = 'center';
            containerAlignment = 'center';
        } else if (message.from.nickname === data.phone) {
            alignment = 'left';
            containerAlignment = 'flex-start';
        }

        let content = message.content;
        if (typeof content === 'object' && content.namespace === 'state:resolved') {
            content = '<em>A conversa foi resolvida.</em>';
        } else {
            content = content.toString().replace(/\n/g, '<br>');
        }

        let messageStyle = `display: inline-block; background-color: #f7f7f7; border-radius: 8px; padding: 10px; margin: 5px; text-align: ${alignment};`;
        let containerStyle = `display: flex; justify-content: ${containerAlignment};`;
        let header = `<strong>[${formattedTimestamp}] ${nameToShow}:</strong>`;

        formattedChat += `<div style="${containerStyle}"><div style="${messageStyle}">${header}<br>${content}</div></div>`;
    });

    return formattedChat;
}



const formattedChat = formatWhatsAppChat(chatData);
document.body.innerHTML = formattedChat;